{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/better-auth@1.4.9_drizzle-kit@0.31.8_drizzle-orm@0.45.1_@opentelemetry+api@1.9.0_@types_2c2f84378f2ef24b1a7bf909953e43a4/node_modules/better-auth/dist/plugins/two-factor/client.mjs","sources":["file:///Users/aunogarafat/Work/conversation/app/web/node_modules/.pnpm/better-auth%401.4.9_drizzle-kit%400.31.8_drizzle-orm%400.45.1_%40opentelemetry%2Bapi%401.9.0_%40types_2c2f84378f2ef24b1a7bf909953e43a4/node_modules/better-auth/src/plugins/two-factor/client.ts"],"sourcesContent":["import type { BetterAuthClientPlugin } from \"@better-auth/core\";\nimport type { twoFactor as twoFa } from \".\";\n\nexport const twoFactorClient = (\n\toptions?:\n\t\t| {\n\t\t\t\t/**\n\t\t\t\t * a redirect function to call if a user needs to verify\n\t\t\t\t * their two factor\n\t\t\t\t */\n\t\t\t\tonTwoFactorRedirect?: () => void | Promise<void>;\n\t\t  }\n\t\t| undefined,\n) => {\n\treturn {\n\t\tid: \"two-factor\",\n\t\t$InferServerPlugin: {} as ReturnType<typeof twoFa>,\n\t\tatomListeners: [\n\t\t\t{\n\t\t\t\tmatcher: (path) => path.startsWith(\"/two-factor/\"),\n\t\t\t\tsignal: \"$sessionSignal\",\n\t\t\t},\n\t\t],\n\t\tpathMethods: {\n\t\t\t\"/two-factor/disable\": \"POST\",\n\t\t\t\"/two-factor/enable\": \"POST\",\n\t\t\t\"/two-factor/send-otp\": \"POST\",\n\t\t\t\"/two-factor/generate-backup-codes\": \"POST\",\n\t\t},\n\t\tfetchPlugins: [\n\t\t\t{\n\t\t\t\tid: \"two-factor\",\n\t\t\t\tname: \"two-factor\",\n\t\t\t\thooks: {\n\t\t\t\t\tasync onSuccess(context) {\n\t\t\t\t\t\tif (context.data?.twoFactorRedirect) {\n\t\t\t\t\t\t\tif (options?.onTwoFactorRedirect) {\n\t\t\t\t\t\t\t\tawait options.onTwoFactorRedirect();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t} satisfies BetterAuthClientPlugin;\n};\n\nexport type * from \"./backup-codes\";\nexport type * from \"./otp\";\nexport type * from \"./totp\";\nexport type * from \"./types\";\n"],"names":[],"mappings":";;;;;AAGA,MAAa,kBAAA,CACZ,YASI;IACJ,OAAO;QACN,IAAI;QACJ,oBAAoB,CAAA,CAAE;QACtB,eAAe;YACd;gBACC,SAAA,CAAU,OAAS,KAAK,UAAA,CAAW,eAAe;gBAClD,QAAQ;aACR;SACD;QACD,aAAa;YACZ,uBAAuB;YACvB,sBAAsB;YACtB,wBAAwB;YACxB,qCAAqC;SACrC;QACD,cAAc;YACb;gBACC,IAAI;gBACJ,MAAM;gBACN,OAAO;oBACN,MAAM,WAAU,OAAA,EAAS;wBACxB,IAAI,QAAQ,IAAA,EAAM,mBACjB;gCAAI,SAAS,oBACZ,CAAA,MAAM,QAAQ,mBAAA,EAAqB;;;iBAItC;aACD;SACD;KACD"}},
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/better-auth@1.4.9_drizzle-kit@0.31.8_drizzle-orm@0.45.1_@opentelemetry+api@1.9.0_@types_2c2f84378f2ef24b1a7bf909953e43a4/node_modules/better-auth/dist/plugins/two-factor/error-code.mjs","sources":["file:///Users/aunogarafat/Work/conversation/app/web/node_modules/.pnpm/better-auth%401.4.9_drizzle-kit%400.31.8_drizzle-orm%400.45.1_%40opentelemetry%2Bapi%401.9.0_%40types_2c2f84378f2ef24b1a7bf909953e43a4/node_modules/better-auth/src/plugins/two-factor/error-code.ts"],"sourcesContent":["import { defineErrorCodes } from \"@better-auth/core/utils\";\n\nexport const TWO_FACTOR_ERROR_CODES = defineErrorCodes({\n\tOTP_NOT_ENABLED: \"OTP not enabled\",\n\tOTP_HAS_EXPIRED: \"OTP has expired\",\n\tTOTP_NOT_ENABLED: \"TOTP not enabled\",\n\tTWO_FACTOR_NOT_ENABLED: \"Two factor isn't enabled\",\n\tBACKUP_CODES_NOT_ENABLED: \"Backup codes aren't enabled\",\n\tINVALID_BACKUP_CODE: \"Invalid backup code\",\n\tINVALID_CODE: \"Invalid code\",\n\tTOO_MANY_ATTEMPTS_REQUEST_NEW_CODE:\n\t\t\"Too many attempts. Please request a new code.\",\n\tINVALID_TWO_FACTOR_COOKIE: \"Invalid two factor cookie\",\n});\n"],"names":[],"mappings":";;;;;;;;AAEA,MAAa,6BAAyB,kbAAA,EAAiB;IACtD,iBAAiB;IACjB,iBAAiB;IACjB,kBAAkB;IAClB,wBAAwB;IACxB,0BAA0B;IAC1B,qBAAqB;IACrB,cAAc;IACd,oCACC;IACD,2BAA2B;CAC3B,CAAC"}},
    {"offset": {"line": 71, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/better-auth@1.4.9_drizzle-kit@0.31.8_drizzle-orm@0.45.1_@opentelemetry+api@1.9.0_@types_2c2f84378f2ef24b1a7bf909953e43a4/node_modules/better-auth/dist/plugins/two-factor/constant.mjs","sources":["file:///Users/aunogarafat/Work/conversation/app/web/node_modules/.pnpm/better-auth%401.4.9_drizzle-kit%400.31.8_drizzle-orm%400.45.1_%40opentelemetry%2Bapi%401.9.0_%40types_2c2f84378f2ef24b1a7bf909953e43a4/node_modules/better-auth/src/plugins/two-factor/constant.ts"],"sourcesContent":["export const TWO_FACTOR_COOKIE_NAME = \"two_factor\";\nexport const TRUST_DEVICE_COOKIE_NAME = \"trust_device\";\nexport const TRUST_DEVICE_COOKIE_MAX_AGE = 30 * 24 * 60 * 60; // 30 days\n"],"names":[],"mappings":";;;;;;;;;AAAA,MAAa,yBAAyB;AACtC,MAAa,2BAA2B;AACxC,MAAa,8BAA8B,MAAU,KAAK"}},
    {"offset": {"line": 89, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/better-auth@1.4.9_drizzle-kit@0.31.8_drizzle-orm@0.45.1_@opentelemetry+api@1.9.0_@types_2c2f84378f2ef24b1a7bf909953e43a4/node_modules/better-auth/dist/plugins/two-factor/verify-two-factor.mjs","sources":["file:///Users/aunogarafat/Work/conversation/app/web/node_modules/.pnpm/better-auth%401.4.9_drizzle-kit%400.31.8_drizzle-orm%400.45.1_%40opentelemetry%2Bapi%401.9.0_%40types_2c2f84378f2ef24b1a7bf909953e43a4/node_modules/better-auth/src/plugins/two-factor/verify-two-factor.ts"],"sourcesContent":["import type { GenericEndpointContext } from \"@better-auth/core\";\nimport { createHMAC } from \"@better-auth/utils/hmac\";\nimport { APIError } from \"better-call\";\nimport { getSessionFromCtx } from \"../../api\";\nimport { setSessionCookie } from \"../../cookies\";\nimport {\n\tTRUST_DEVICE_COOKIE_MAX_AGE,\n\tTRUST_DEVICE_COOKIE_NAME,\n\tTWO_FACTOR_COOKIE_NAME,\n} from \"./constant\";\nimport { TWO_FACTOR_ERROR_CODES } from \"./error-code\";\nimport type { UserWithTwoFactor } from \"./types\";\n\nexport async function verifyTwoFactor(ctx: GenericEndpointContext) {\n\tconst invalid = (errorKey: keyof typeof TWO_FACTOR_ERROR_CODES) => {\n\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\tmessage: TWO_FACTOR_ERROR_CODES[errorKey],\n\t\t});\n\t};\n\n\tconst session = await getSessionFromCtx(ctx);\n\tif (!session) {\n\t\tconst cookieName = ctx.context.createAuthCookie(TWO_FACTOR_COOKIE_NAME);\n\t\tconst twoFactorCookie = await ctx.getSignedCookie(\n\t\t\tcookieName.name,\n\t\t\tctx.context.secret,\n\t\t);\n\t\tif (!twoFactorCookie) {\n\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.INVALID_TWO_FACTOR_COOKIE,\n\t\t\t});\n\t\t}\n\t\tconst verificationToken =\n\t\t\tawait ctx.context.internalAdapter.findVerificationValue(twoFactorCookie);\n\t\tif (!verificationToken) {\n\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.INVALID_TWO_FACTOR_COOKIE,\n\t\t\t});\n\t\t}\n\t\tconst user = (await ctx.context.internalAdapter.findUserById(\n\t\t\tverificationToken.value,\n\t\t)) as UserWithTwoFactor;\n\t\tif (!user) {\n\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.INVALID_TWO_FACTOR_COOKIE,\n\t\t\t});\n\t\t}\n\t\tconst dontRememberMe = await ctx.getSignedCookie(\n\t\t\tctx.context.authCookies.dontRememberToken.name,\n\t\t\tctx.context.secret,\n\t\t);\n\t\treturn {\n\t\t\tvalid: async (ctx: GenericEndpointContext) => {\n\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(\n\t\t\t\t\tverificationToken.value,\n\t\t\t\t\t!!dontRememberMe,\n\t\t\t\t);\n\t\t\t\tif (!session) {\n\t\t\t\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\t\tmessage: \"failed to create session\",\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t// Delete the verification token from the database after successful verification\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\tverificationToken.id,\n\t\t\t\t);\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession,\n\t\t\t\t\tuser,\n\t\t\t\t});\n\t\t\t\t// Always clear the two factor cookie after successful verification\n\t\t\t\tctx.setCookie(cookieName.name, \"\", {\n\t\t\t\t\tmaxAge: 0,\n\t\t\t\t});\n\t\t\t\tif (ctx.body.trustDevice) {\n\t\t\t\t\tconst trustDeviceCookie = ctx.context.createAuthCookie(\n\t\t\t\t\t\tTRUST_DEVICE_COOKIE_NAME,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmaxAge: TRUST_DEVICE_COOKIE_MAX_AGE,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t\t/**\n\t\t\t\t\t * create a token that will be used to\n\t\t\t\t\t * verify the device\n\t\t\t\t\t */\n\t\t\t\t\tconst token = await createHMAC(\"SHA-256\", \"base64urlnopad\").sign(\n\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\t`${user.id}!${session.token}`,\n\t\t\t\t\t);\n\t\t\t\t\tawait ctx.setSignedCookie(\n\t\t\t\t\t\ttrustDeviceCookie.name,\n\t\t\t\t\t\t`${token}!${session.token}`,\n\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\ttrustDeviceCookie.attributes,\n\t\t\t\t\t);\n\t\t\t\t\t// delete the dont remember me cookie\n\t\t\t\t\tctx.setCookie(ctx.context.authCookies.dontRememberToken.name, \"\", {\n\t\t\t\t\t\tmaxAge: 0,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn ctx.json({\n\t\t\t\t\ttoken: session.token,\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: user.id,\n\t\t\t\t\t\temail: user.email,\n\t\t\t\t\t\temailVerified: user.emailVerified,\n\t\t\t\t\t\tname: user.name,\n\t\t\t\t\t\timage: user.image,\n\t\t\t\t\t\tcreatedAt: user.createdAt,\n\t\t\t\t\t\tupdatedAt: user.updatedAt,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tinvalid,\n\t\t\tsession: {\n\t\t\t\tsession: null,\n\t\t\t\tuser,\n\t\t\t},\n\t\t\tkey: twoFactorCookie,\n\t\t};\n\t}\n\treturn {\n\t\tvalid: async (ctx: GenericEndpointContext) => {\n\t\t\treturn ctx.json({\n\t\t\t\ttoken: session.session.token,\n\t\t\t\tuser: {\n\t\t\t\t\tid: session.user.id,\n\t\t\t\t\temail: session.user.email,\n\t\t\t\t\temailVerified: session.user.emailVerified,\n\t\t\t\t\tname: session.user.name,\n\t\t\t\t\timage: session.user.image,\n\t\t\t\t\tcreatedAt: session.user.createdAt,\n\t\t\t\t\tupdatedAt: session.user.updatedAt,\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\tinvalid,\n\t\tsession,\n\t\tkey: `${session.user.id}!${session.session.id}`,\n\t};\n}\n"],"names":["session","ctx"],"mappings":"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"}},
    {"offset": {"line": 205, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/better-auth@1.4.9_drizzle-kit@0.31.8_drizzle-orm@0.45.1_@opentelemetry+api@1.9.0_@types_2c2f84378f2ef24b1a7bf909953e43a4/node_modules/better-auth/dist/plugins/two-factor/backup-codes/index.mjs","sources":["file:///Users/aunogarafat/Work/conversation/app/web/node_modules/.pnpm/better-auth%401.4.9_drizzle-kit%400.31.8_drizzle-orm%400.45.1_%40opentelemetry%2Bapi%401.9.0_%40types_2c2f84378f2ef24b1a7bf909953e43a4/node_modules/better-auth/src/plugins/two-factor/backup-codes/index.ts"],"sourcesContent":["import { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { safeJSONParse } from \"@better-auth/core/utils\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { sessionMiddleware } from \"../../../api\";\nimport { symmetricDecrypt, symmetricEncrypt } from \"../../../crypto\";\nimport { generateRandomString } from \"../../../crypto/random\";\nimport { TWO_FACTOR_ERROR_CODES } from \"../error-code\";\nimport type {\n\tTwoFactorProvider,\n\tTwoFactorTable,\n\tUserWithTwoFactor,\n} from \"../types\";\nimport { verifyTwoFactor } from \"../verify-two-factor\";\n\nexport interface BackupCodeOptions {\n\t/**\n\t * The amount of backup codes to generate\n\t *\n\t * @default 10\n\t */\n\tamount?: number | undefined;\n\t/**\n\t * The length of the backup codes\n\t *\n\t * @default 10\n\t */\n\tlength?: number | undefined;\n\t/**\n\t * An optional custom function to generate backup codes\n\t */\n\tcustomBackupCodesGenerate?: (() => string[]) | undefined;\n\t/**\n\t * How to store the backup codes in the database, whether encrypted or plain.\n\t */\n\tstoreBackupCodes?:\n\t\t| (\n\t\t\t\t| \"plain\"\n\t\t\t\t| \"encrypted\"\n\t\t\t\t| {\n\t\t\t\t\t\tencrypt: (token: string) => Promise<string>;\n\t\t\t\t\t\tdecrypt: (token: string) => Promise<string>;\n\t\t\t\t  }\n\t\t  )\n\t\t| undefined;\n}\n\nfunction generateBackupCodesFn(options?: BackupCodeOptions | undefined) {\n\treturn Array.from({ length: options?.amount ?? 10 })\n\t\t.fill(null)\n\t\t.map(() => generateRandomString(options?.length ?? 10, \"a-z\", \"0-9\", \"A-Z\"))\n\t\t.map((code) => `${code.slice(0, 5)}-${code.slice(5)}`);\n}\n\nexport async function generateBackupCodes(\n\tsecret: string,\n\toptions?: BackupCodeOptions | undefined,\n) {\n\tconst backupCodes = options?.customBackupCodesGenerate\n\t\t? options.customBackupCodesGenerate()\n\t\t: generateBackupCodesFn(options);\n\tif (options?.storeBackupCodes === \"encrypted\") {\n\t\tconst encCodes = await symmetricEncrypt({\n\t\t\tdata: JSON.stringify(backupCodes),\n\t\t\tkey: secret,\n\t\t});\n\t\treturn {\n\t\t\tbackupCodes,\n\t\t\tencryptedBackupCodes: encCodes,\n\t\t};\n\t}\n\tif (\n\t\ttypeof options?.storeBackupCodes === \"object\" &&\n\t\t\"encrypt\" in options?.storeBackupCodes\n\t) {\n\t\treturn {\n\t\t\tbackupCodes,\n\t\t\tencryptedBackupCodes: await options?.storeBackupCodes.encrypt(\n\t\t\t\tJSON.stringify(backupCodes),\n\t\t\t),\n\t\t};\n\t}\n\treturn {\n\t\tbackupCodes,\n\t\tencryptedBackupCodes: JSON.stringify(backupCodes),\n\t};\n}\n\nexport async function verifyBackupCode(\n\tdata: {\n\t\tbackupCodes: string;\n\t\tcode: string;\n\t},\n\tkey: string,\n\toptions?: BackupCodeOptions | undefined,\n) {\n\tconst codes = await getBackupCodes(data.backupCodes, key, options);\n\tif (!codes) {\n\t\treturn {\n\t\t\tstatus: false,\n\t\t\tupdated: null,\n\t\t};\n\t}\n\treturn {\n\t\tstatus: codes.includes(data.code),\n\t\tupdated: codes.filter((code) => code !== data.code),\n\t};\n}\n\nexport async function getBackupCodes(\n\tbackupCodes: string,\n\tkey: string,\n\toptions?: BackupCodeOptions | undefined,\n) {\n\tif (options?.storeBackupCodes === \"encrypted\") {\n\t\tconst decrypted = await symmetricDecrypt({ key, data: backupCodes });\n\t\treturn safeJSONParse<string[]>(decrypted);\n\t}\n\tif (\n\t\ttypeof options?.storeBackupCodes === \"object\" &&\n\t\t\"decrypt\" in options?.storeBackupCodes\n\t) {\n\t\tconst decrypted = await options?.storeBackupCodes.decrypt(backupCodes);\n\t\treturn safeJSONParse<string[]>(decrypted);\n\t}\n\n\treturn safeJSONParse<string[]>(backupCodes);\n}\n\nconst verifyBackupCodeBodySchema = z.object({\n\tcode: z.string().meta({\n\t\tdescription: `A backup code to verify. Eg: \"123456\"`,\n\t}),\n\t/**\n\t * Disable setting the session cookie\n\t */\n\tdisableSession: z\n\t\t.boolean()\n\t\t.meta({\n\t\t\tdescription: \"If true, the session cookie will not be set.\",\n\t\t})\n\t\t.optional(),\n\t/**\n\t * if true, the device will be trusted\n\t * for 30 days. It'll be refreshed on\n\t * every sign in request within this time.\n\t */\n\ttrustDevice: z\n\t\t.boolean()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t\"If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time. Eg: true\",\n\t\t})\n\t\t.optional(),\n});\n\nconst viewBackupCodesBodySchema = z.object({\n\tuserId: z.coerce.string().meta({\n\t\tdescription: `The user ID to view all backup codes. Eg: \"user-id\"`,\n\t}),\n});\n\nconst generateBackupCodesBodySchema = z.object({\n\tpassword: z.string().meta({\n\t\tdescription: \"The users password.\",\n\t}),\n});\n\nexport const backupCode2fa = (opts: BackupCodeOptions) => {\n\tconst twoFactorTable = \"twoFactor\";\n\n\treturn {\n\t\tid: \"backup_code\",\n\t\tendpoints: {\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/two-factor/verify-backup-code`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.verifyBackupCode`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.twoFactor.verifyBackupCode`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/2fa#api-method-two-factor-verify-backup-code)\n\t\t\t */\n\t\t\tverifyBackupCode: createAuthEndpoint(\n\t\t\t\t\"/two-factor/verify-backup-code\",\n\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: verifyBackupCodeBodySchema,\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tdescription: \"Verify a backup code for two-factor authentication\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\t\t\tdescription: \"Backup code verified successfully\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier of the user\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\temail: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"email\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's email address\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\temailVerified: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Whether the email is verified\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's name\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\timage: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's profile image URL\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttwoFactorEnabled: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Whether two-factor authentication is enabled for the user\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Timestamp when the user was created\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Timestamp when the user was last updated\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"twoFactorEnabled\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"updatedAt\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"The authenticated user object with two-factor details\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Session token\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"ID of the user associated with the session\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Timestamp when the session was created\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\texpiresAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Timestamp when the session expires\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"token\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"userId\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"expiresAt\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"The current session object, included unless disableSession is true\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\trequired: [\"user\", \"session\"],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst { session, valid } = await verifyTwoFactor(ctx);\n\t\t\t\t\tconst user = session.user as UserWithTwoFactor;\n\t\t\t\t\tconst twoFactor = await ctx.context.adapter.findOne<TwoFactorTable>({\n\t\t\t\t\t\tmodel: twoFactorTable,\n\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\t\t\tvalue: user.id,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t\tif (!twoFactor) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.BACKUP_CODES_NOT_ENABLED,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst validate = await verifyBackupCode(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbackupCodes: twoFactor.backupCodes,\n\t\t\t\t\t\t\tcode: ctx.body.code,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\topts,\n\t\t\t\t\t);\n\t\t\t\t\tif (!validate.status) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.INVALID_BACKUP_CODE,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst updatedBackupCodes = await symmetricEncrypt({\n\t\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\t\tdata: JSON.stringify(validate.updated),\n\t\t\t\t\t});\n\n\t\t\t\t\tconst updated = await ctx.context.adapter.updateMany({\n\t\t\t\t\t\tmodel: twoFactorTable,\n\t\t\t\t\t\tupdate: {\n\t\t\t\t\t\t\tbackupCodes: updatedBackupCodes,\n\t\t\t\t\t\t},\n\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\t\t\tvalue: user.id,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfield: \"backupCodes\",\n\t\t\t\t\t\t\t\tvalue: twoFactor.backupCodes,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t\tif (!updated) {\n\t\t\t\t\t\tthrow new APIError(\"CONFLICT\", {\n\t\t\t\t\t\t\tmessage: \"Failed to verify backup code. Please try again.\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!ctx.body.disableSession) {\n\t\t\t\t\t\treturn valid(ctx);\n\t\t\t\t\t}\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\ttoken: session.session?.token,\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\tid: session.user?.id,\n\t\t\t\t\t\t\temail: session.user.email,\n\t\t\t\t\t\t\temailVerified: session.user.emailVerified,\n\t\t\t\t\t\t\tname: session.user.name,\n\t\t\t\t\t\t\timage: session.user.image,\n\t\t\t\t\t\t\tcreatedAt: session.user.createdAt,\n\t\t\t\t\t\t\tupdatedAt: session.user.updatedAt,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/two-factor/generate-backup-codes`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.generateBackupCodes`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.twoFactor.generateBackupCodes`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/2fa#api-method-two-factor-generate-backup-codes)\n\t\t\t */\n\t\t\tgenerateBackupCodes: createAuthEndpoint(\n\t\t\t\t\"/two-factor/generate-backup-codes\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: generateBackupCodesBodySchema,\n\t\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\"Generate new backup codes for two-factor authentication\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\t\t\tdescription: \"Backup codes generated successfully\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Indicates if the backup codes were generated successfully\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tenum: [true],\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tbackupCodes: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\titems: { type: \"string\" },\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Array of generated backup codes in plain text\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\trequired: [\"status\", \"backupCodes\"],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst user = ctx.context.session.user as UserWithTwoFactor;\n\t\t\t\t\tif (!user.twoFactorEnabled) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.TWO_FACTOR_NOT_ENABLED,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tawait ctx.context.password.checkPassword(user.id, ctx);\n\t\t\t\t\tconst backupCodes = await generateBackupCodes(\n\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\topts,\n\t\t\t\t\t);\n\t\t\t\t\tawait ctx.context.adapter.updateMany({\n\t\t\t\t\t\tmodel: twoFactorTable,\n\t\t\t\t\t\tupdate: {\n\t\t\t\t\t\t\tbackupCodes: backupCodes.encryptedBackupCodes,\n\t\t\t\t\t\t},\n\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\t\t\tvalue: ctx.context.session.user.id,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\tbackupCodes: backupCodes.backupCodes,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/two-factor/view-backup-codes`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.viewBackupCodes`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/2fa#api-method-two-factor-view-backup-codes)\n\t\t\t */\n\t\t\tviewBackupCodes: createAuthEndpoint(\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: viewBackupCodesBodySchema,\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst twoFactor = await ctx.context.adapter.findOne<TwoFactorTable>({\n\t\t\t\t\t\tmodel: twoFactorTable,\n\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\t\t\tvalue: ctx.body.userId,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t\tif (!twoFactor) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.BACKUP_CODES_NOT_ENABLED,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst decryptedBackupCodes = await getBackupCodes(\n\t\t\t\t\t\ttwoFactor.backupCodes,\n\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\topts,\n\t\t\t\t\t);\n\n\t\t\t\t\tif (!decryptedBackupCodes) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.INVALID_BACKUP_CODE,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\tbackupCodes: decryptedBackupCodes,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t},\n\t} satisfies TwoFactorProvider;\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 570, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/better-auth@1.4.9_drizzle-kit@0.31.8_drizzle-orm@0.45.1_@opentelemetry+api@1.9.0_@types_2c2f84378f2ef24b1a7bf909953e43a4/node_modules/better-auth/dist/plugins/two-factor/utils.mjs","sources":["file:///Users/aunogarafat/Work/conversation/app/web/node_modules/.pnpm/better-auth%401.4.9_drizzle-kit%400.31.8_drizzle-orm%400.45.1_%40opentelemetry%2Bapi%401.9.0_%40types_2c2f84378f2ef24b1a7bf909953e43a4/node_modules/better-auth/src/plugins/two-factor/utils.ts"],"sourcesContent":["import { base64Url } from \"@better-auth/utils/base64\";\nimport { createHash } from \"@better-auth/utils/hash\";\n\nexport const defaultKeyHasher = async (token: string) => {\n\tconst hash = await createHash(\"SHA-256\").digest(\n\t\tnew TextEncoder().encode(token),\n\t);\n\tconst hashed = base64Url.encode(new Uint8Array(hash), {\n\t\tpadding: false,\n\t});\n\treturn hashed;\n};\n"],"names":[],"mappings":";;;;;;;;;AAGA,MAAa,mBAAmB,OAAO,UAAkB;IACxD,MAAM,OAAO,UAAM,gPAAA,EAAW,UAAU,CAAC,MAAA,CACxC,IAAI,aAAa,CAAC,MAAA,CAAO,MAAM,CAC/B;IAID,OAHe,iPAAA,CAAU,MAAA,CAAO,IAAI,WAAW,KAAK,EAAE;QACrD,SAAS;IAAA,CACT,CAAC"}},
    {"offset": {"line": 591, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/better-auth@1.4.9_drizzle-kit@0.31.8_drizzle-orm@0.45.1_@opentelemetry+api@1.9.0_@types_2c2f84378f2ef24b1a7bf909953e43a4/node_modules/better-auth/dist/plugins/two-factor/otp/index.mjs","sources":["file:///Users/aunogarafat/Work/conversation/app/web/node_modules/.pnpm/better-auth%401.4.9_drizzle-kit%400.31.8_drizzle-orm%400.45.1_%40opentelemetry%2Bapi%401.9.0_%40types_2c2f84378f2ef24b1a7bf909953e43a4/node_modules/better-auth/src/plugins/two-factor/otp/index.ts"],"sourcesContent":["import type { Awaitable, GenericEndpointContext } from \"@better-auth/core\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { setSessionCookie } from \"../../../cookies\";\nimport {\n\tconstantTimeEqual,\n\tgenerateRandomString,\n\tsymmetricDecrypt,\n\tsymmetricEncrypt,\n} from \"../../../crypto\";\nimport { TWO_FACTOR_ERROR_CODES } from \"../error-code\";\nimport type { TwoFactorProvider, UserWithTwoFactor } from \"../types\";\nimport { defaultKeyHasher } from \"../utils\";\nimport { verifyTwoFactor } from \"../verify-two-factor\";\n\nexport interface OTPOptions {\n\t/**\n\t * How long the opt will be valid for in\n\t * minutes\n\t *\n\t * @default \"3 mins\"\n\t */\n\tperiod?: number | undefined;\n\t/**\n\t * Number of digits for the OTP code\n\t *\n\t * @default 6\n\t */\n\tdigits?: number | undefined;\n\t/**\n\t * Send the otp to the user\n\t *\n\t * @param user - The user to send the otp to\n\t * @param otp - The otp to send\n\t * @param request - The request object\n\t * @returns void | Promise<void>\n\t */\n\tsendOTP?:\n\t\t| ((\n\t\t\t\t/**\n\t\t\t\t * The user to send the otp to\n\t\t\t\t * @type UserWithTwoFactor\n\t\t\t\t * @default UserWithTwoFactors\n\t\t\t\t */\n\t\t\t\tdata: {\n\t\t\t\t\tuser: UserWithTwoFactor;\n\t\t\t\t\totp: string;\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * The request object\n\t\t\t\t */\n\t\t\t\tctx?: GenericEndpointContext,\n\t\t  ) => Awaitable<void>)\n\t\t| undefined;\n\t/**\n\t * The number of allowed attempts for the OTP\n\t *\n\t * @default 5\n\t */\n\tallowedAttempts?: number | undefined;\n\tstoreOTP?:\n\t\t| (\n\t\t\t\t| \"plain\"\n\t\t\t\t| \"encrypted\"\n\t\t\t\t| \"hashed\"\n\t\t\t\t| { hash: (token: string) => Promise<string> }\n\t\t\t\t| {\n\t\t\t\t\t\tencrypt: (token: string) => Promise<string>;\n\t\t\t\t\t\tdecrypt: (token: string) => Promise<string>;\n\t\t\t\t  }\n\t\t  )\n\t\t| undefined;\n}\n\nconst verifyOTPBodySchema = z.object({\n\tcode: z.string().meta({\n\t\tdescription: 'The otp code to verify. Eg: \"012345\"',\n\t}),\n\t/**\n\t * if true, the device will be trusted\n\t * for 30 days. It'll be refreshed on\n\t * every sign in request within this time.\n\t */\n\ttrustDevice: z.boolean().optional().meta({\n\t\tdescription:\n\t\t\t\"If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time. Eg: true\",\n\t}),\n});\n\nconst send2FaOTPBodySchema = z\n\t.object({\n\t\t/**\n\t\t * if true, the device will be trusted\n\t\t * for 30 days. It'll be refreshed on\n\t\t * every sign in request within this time.\n\t\t */\n\t\ttrustDevice: z.boolean().optional().meta({\n\t\t\tdescription:\n\t\t\t\t\"If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time. Eg: true\",\n\t\t}),\n\t})\n\t.optional();\n\n/**\n * The otp adapter is created from the totp adapter.\n */\nexport const otp2fa = (options?: OTPOptions | undefined) => {\n\tconst opts = {\n\t\tstoreOTP: \"plain\",\n\t\tdigits: 6,\n\t\t...options,\n\t\tperiod: (options?.period || 3) * 60 * 1000,\n\t};\n\n\tasync function storeOTP(ctx: GenericEndpointContext, otp: string) {\n\t\tif (opts.storeOTP === \"hashed\") {\n\t\t\treturn await defaultKeyHasher(otp);\n\t\t}\n\t\tif (typeof opts.storeOTP === \"object\" && \"hash\" in opts.storeOTP) {\n\t\t\treturn await opts.storeOTP.hash(otp);\n\t\t}\n\t\tif (typeof opts.storeOTP === \"object\" && \"encrypt\" in opts.storeOTP) {\n\t\t\treturn await opts.storeOTP.encrypt(otp);\n\t\t}\n\t\tif (opts.storeOTP === \"encrypted\") {\n\t\t\treturn await symmetricEncrypt({\n\t\t\t\tkey: ctx.context.secret,\n\t\t\t\tdata: otp,\n\t\t\t});\n\t\t}\n\t\treturn otp;\n\t}\n\n\tasync function decryptOTP(ctx: GenericEndpointContext, otp: string) {\n\t\tif (opts.storeOTP === \"hashed\") {\n\t\t\treturn await defaultKeyHasher(otp);\n\t\t}\n\t\tif (opts.storeOTP === \"encrypted\") {\n\t\t\treturn await symmetricDecrypt({\n\t\t\t\tkey: ctx.context.secret,\n\t\t\t\tdata: otp,\n\t\t\t});\n\t\t}\n\t\tif (typeof opts.storeOTP === \"object\" && \"encrypt\" in opts.storeOTP) {\n\t\t\treturn await opts.storeOTP.decrypt(otp);\n\t\t}\n\t\tif (typeof opts.storeOTP === \"object\" && \"hash\" in opts.storeOTP) {\n\t\t\treturn await opts.storeOTP.hash(otp);\n\t\t}\n\t\treturn otp;\n\t}\n\n\t/**\n\t * Generate OTP and send it to the user.\n\t */\n\tconst send2FaOTP = createAuthEndpoint(\n\t\t\"/two-factor/send-otp\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: send2FaOTPBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tsummary: \"Send two factor OTP\",\n\t\t\t\t\tdescription: \"Send two factor OTP to the user\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tif (!options || !options.sendOTP) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t\"send otp isn't configured. Please configure the send otp function on otp options.\",\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"otp isn't configured\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst { session, key } = await verifyTwoFactor(ctx);\n\t\t\tconst code = generateRandomString(opts.digits, \"0-9\");\n\t\t\tconst hashedCode = await storeOTP(ctx, code);\n\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\tvalue: `${hashedCode}:0`,\n\t\t\t\tidentifier: `2fa-otp-${key}`,\n\t\t\t\texpiresAt: new Date(Date.now() + opts.period),\n\t\t\t});\n\t\t\tconst sendOTPResult = options.sendOTP(\n\t\t\t\t{ user: session.user as UserWithTwoFactor, otp: code },\n\t\t\t\tctx,\n\t\t\t);\n\t\t\tif (sendOTPResult instanceof Promise) {\n\t\t\t\tawait ctx.context.runInBackgroundOrAwait(\n\t\t\t\t\tsendOTPResult.catch((e: unknown) => {\n\t\t\t\t\t\tctx.context.logger.error(\"Failed to send two-factor OTP\", e);\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn ctx.json({ status: true });\n\t\t},\n\t);\n\n\tconst verifyOTP = createAuthEndpoint(\n\t\t\"/two-factor/verify-otp\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: verifyOTPBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tsummary: \"Verify two factor OTP\",\n\t\t\t\t\tdescription: \"Verify two factor OTP\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Two-factor OTP verified successfully\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Session token for the authenticated session\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier of the user\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\temail: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"email\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's email address\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\temailVerified: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Whether the email is verified\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's name\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\timage: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's profile image URL\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the user was created\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Timestamp when the user was last updated\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\trequired: [\"id\", \"createdAt\", \"updatedAt\"],\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"The authenticated user object\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\"token\", \"user\"],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst { session, key, valid, invalid } = await verifyTwoFactor(ctx);\n\t\t\tconst toCheckOtp =\n\t\t\t\tawait ctx.context.internalAdapter.findVerificationValue(\n\t\t\t\t\t`2fa-otp-${key}`,\n\t\t\t\t);\n\t\t\tconst [otp, counter] = toCheckOtp?.value?.split(\":\") ?? [];\n\t\t\tconst decryptedOtp = await decryptOTP(ctx, otp!);\n\t\t\tif (!toCheckOtp || toCheckOtp.expiresAt < new Date()) {\n\t\t\t\tif (toCheckOtp) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\t\ttoCheckOtp.id,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.OTP_HAS_EXPIRED,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst allowedAttempts = options?.allowedAttempts || 5;\n\t\t\tif (parseInt(counter!) >= allowedAttempts) {\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\ttoCheckOtp.id,\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.TOO_MANY_ATTEMPTS_REQUEST_NEW_CODE,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst isCodeValid = constantTimeEqual(\n\t\t\t\tnew TextEncoder().encode(decryptedOtp),\n\t\t\t\tnew TextEncoder().encode(ctx.body.code),\n\t\t\t);\n\t\t\tif (isCodeValid) {\n\t\t\t\tif (!session.user.twoFactorEnabled) {\n\t\t\t\t\tif (!session.session) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(\n\t\t\t\t\t\tsession.user.id,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttwoFactorEnabled: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t\tconst newSession = await ctx.context.internalAdapter.createSession(\n\t\t\t\t\t\tsession.user.id,\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\tsession.session,\n\t\t\t\t\t);\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteSession(\n\t\t\t\t\t\tsession.session.token,\n\t\t\t\t\t);\n\t\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\t\tsession: newSession,\n\t\t\t\t\t\tuser: updatedUser,\n\t\t\t\t\t});\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\ttoken: newSession.token,\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\tid: updatedUser.id,\n\t\t\t\t\t\t\temail: updatedUser.email,\n\t\t\t\t\t\t\temailVerified: updatedUser.emailVerified,\n\t\t\t\t\t\t\tname: updatedUser.name,\n\t\t\t\t\t\t\timage: updatedUser.image,\n\t\t\t\t\t\t\tcreatedAt: updatedUser.createdAt,\n\t\t\t\t\t\t\tupdatedAt: updatedUser.updatedAt,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn valid(ctx);\n\t\t\t} else {\n\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(\n\t\t\t\t\ttoCheckOtp.id,\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: `${otp}:${(parseInt(counter!, 10) || 0) + 1}`,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\treturn invalid(\"INVALID_CODE\");\n\t\t\t}\n\t\t},\n\t);\n\n\treturn {\n\t\tid: \"otp\",\n\t\tendpoints: {\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/two-factor/send-otp`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.send2FaOTP`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.twoFactor.sendOtp`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/2fa#api-method-two-factor-send-otp)\n\t\t\t */\n\t\t\tsendTwoFactorOTP: send2FaOTP,\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/two-factor/verify-otp`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.verifyOTP`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.twoFactor.verifyOtp`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/2fa#api-method-two-factor-verify-otp)\n\t\t\t */\n\t\t\tverifyTwoFactorOTP: verifyOTP,\n\t\t},\n\t} satisfies TwoFactorProvider;\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 857, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/better-auth@1.4.9_drizzle-kit@0.31.8_drizzle-orm@0.45.1_@opentelemetry+api@1.9.0_@types_2c2f84378f2ef24b1a7bf909953e43a4/node_modules/better-auth/dist/plugins/two-factor/schema.mjs","sources":["file:///Users/aunogarafat/Work/conversation/app/web/node_modules/.pnpm/better-auth%401.4.9_drizzle-kit%400.31.8_drizzle-orm%400.45.1_%40opentelemetry%2Bapi%401.9.0_%40types_2c2f84378f2ef24b1a7bf909953e43a4/node_modules/better-auth/src/plugins/two-factor/schema.ts"],"sourcesContent":["import type { BetterAuthPluginDBSchema } from \"@better-auth/core/db\";\n\nexport const schema = {\n\tuser: {\n\t\tfields: {\n\t\t\ttwoFactorEnabled: {\n\t\t\t\ttype: \"boolean\",\n\t\t\t\trequired: false,\n\t\t\t\tdefaultValue: false,\n\t\t\t\tinput: false,\n\t\t\t},\n\t\t},\n\t},\n\ttwoFactor: {\n\t\tfields: {\n\t\t\tsecret: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: true,\n\t\t\t\treturned: false,\n\t\t\t\tindex: true,\n\t\t\t},\n\t\t\tbackupCodes: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: true,\n\t\t\t\treturned: false,\n\t\t\t},\n\t\t\tuserId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: true,\n\t\t\t\treturned: false,\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t},\n\t\t\t\tindex: true,\n\t\t\t},\n\t\t},\n\t},\n} satisfies BetterAuthPluginDBSchema;\n"],"names":[],"mappings":";;;;;AAEA,MAAa,SAAS;IACrB,MAAM;QACL,QAAQ;YACP,kBAAkB;gBACjB,MAAM;gBACN,UAAU;gBACV,cAAc;gBACd,OAAO;aACP;QAAA,CACD;IAAA,CACD;IACD,WAAW;QACV,QAAQ;YACP,QAAQ;gBACP,MAAM;gBACN,UAAU;gBACV,UAAU;gBACV,OAAO;aACP;YACD,aAAa;gBACZ,MAAM;gBACN,UAAU;gBACV,UAAU;aACV;YACD,QAAQ;gBACP,MAAM;gBACN,UAAU;gBACV,UAAU;gBACV,YAAY;oBACX,OAAO;oBACP,OAAO;iBACP;gBACD,OAAO;aACP;SACD;IAAA,CACD;CACD"}},
    {"offset": {"line": 905, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/better-auth@1.4.9_drizzle-kit@0.31.8_drizzle-orm@0.45.1_@opentelemetry+api@1.9.0_@types_2c2f84378f2ef24b1a7bf909953e43a4/node_modules/better-auth/dist/plugins/two-factor/totp/index.mjs","sources":["file:///Users/aunogarafat/Work/conversation/app/web/node_modules/.pnpm/better-auth%401.4.9_drizzle-kit%400.31.8_drizzle-orm%400.45.1_%40opentelemetry%2Bapi%401.9.0_%40types_2c2f84378f2ef24b1a7bf909953e43a4/node_modules/better-auth/src/plugins/two-factor/totp/index.ts"],"sourcesContent":["import { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { createOTP } from \"@better-auth/utils/otp\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { sessionMiddleware } from \"../../../api\";\nimport { setSessionCookie } from \"../../../cookies\";\nimport { symmetricDecrypt } from \"../../../crypto\";\nimport type { BackupCodeOptions } from \"../backup-codes\";\nimport { TWO_FACTOR_ERROR_CODES } from \"../error-code\";\nimport type {\n\tTwoFactorProvider,\n\tTwoFactorTable,\n\tUserWithTwoFactor,\n} from \"../types\";\nimport { verifyTwoFactor } from \"../verify-two-factor\";\n\nexport type TOTPOptions = {\n\t/**\n\t * Issuer\n\t */\n\tissuer?: string | undefined;\n\t/**\n\t * How many digits the otp to be\n\t *\n\t * @default 6\n\t */\n\tdigits?: (6 | 8) | undefined;\n\t/**\n\t * Period for otp in seconds.\n\t * @default 30\n\t */\n\tperiod?: number | undefined;\n\t/**\n\t * Backup codes configuration\n\t */\n\tbackupCodes?: BackupCodeOptions | undefined;\n\t/**\n\t * Disable totp\n\t */\n\tdisable?: boolean | undefined;\n};\n\nconst generateTOTPBodySchema = z.object({\n\tsecret: z.string().meta({\n\t\tdescription: \"The secret to generate the TOTP code\",\n\t}),\n});\n\nconst getTOTPURIBodySchema = z.object({\n\tpassword: z.string().meta({\n\t\tdescription: \"User password\",\n\t}),\n});\n\nconst verifyTOTPBodySchema = z.object({\n\tcode: z.string().meta({\n\t\tdescription: 'The otp code to verify. Eg: \"012345\"',\n\t}),\n\t/**\n\t * if true, the device will be trusted\n\t * for 30 days. It'll be refreshed on\n\t * every sign in request within this time.\n\t */\n\ttrustDevice: z\n\t\t.boolean()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t\"If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time. Eg: true\",\n\t\t})\n\t\t.optional(),\n});\n\nexport const totp2fa = (options?: TOTPOptions | undefined) => {\n\tconst opts = {\n\t\t...options,\n\t\tdigits: options?.digits || 6,\n\t\tperiod: options?.period || 30,\n\t};\n\n\tconst twoFactorTable = \"twoFactor\";\n\n\tconst generateTOTP = createAuthEndpoint(\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: generateTOTPBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tsummary: \"Generate TOTP code\",\n\t\t\t\t\tdescription: \"Use this endpoint to generate a TOTP code\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tcode: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tif (options?.disable) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t\"totp isn't configured. please pass totp option on two factor plugin to enable totp\",\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"totp isn't configured\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst code = await createOTP(ctx.body.secret, {\n\t\t\t\tperiod: opts.period,\n\t\t\t\tdigits: opts.digits,\n\t\t\t}).totp();\n\t\t\treturn { code };\n\t\t},\n\t);\n\n\tconst getTOTPURI = createAuthEndpoint(\n\t\t\"/two-factor/get-totp-uri\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tuse: [sessionMiddleware],\n\t\t\tbody: getTOTPURIBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tsummary: \"Get TOTP URI\",\n\t\t\t\t\tdescription: \"Use this endpoint to get the TOTP URI\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\ttotpURI: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tif (options?.disable) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t\"totp isn't configured. please pass totp option on two factor plugin to enable totp\",\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"totp isn't configured\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst user = ctx.context.session.user as UserWithTwoFactor;\n\t\t\tconst twoFactor = await ctx.context.adapter.findOne<TwoFactorTable>({\n\t\t\t\tmodel: twoFactorTable,\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: user.id,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\tif (!twoFactor) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.TOTP_NOT_ENABLED,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst secret = await symmetricDecrypt({\n\t\t\t\tkey: ctx.context.secret,\n\t\t\t\tdata: twoFactor.secret,\n\t\t\t});\n\t\t\tawait ctx.context.password.checkPassword(user.id, ctx);\n\t\t\tconst totpURI = createOTP(secret, {\n\t\t\t\tdigits: opts.digits,\n\t\t\t\tperiod: opts.period,\n\t\t\t}).url(options?.issuer || ctx.context.appName, user.email);\n\t\t\treturn {\n\t\t\t\ttotpURI,\n\t\t\t};\n\t\t},\n\t);\n\n\tconst verifyTOTP = createAuthEndpoint(\n\t\t\"/two-factor/verify-totp\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: verifyTOTPBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tsummary: \"Verify two factor TOTP\",\n\t\t\t\t\tdescription: \"Verify two factor TOTP\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tif (options?.disable) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t\"totp isn't configured. please pass totp option on two factor plugin to enable totp\",\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"totp isn't configured\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst { session, valid, invalid } = await verifyTwoFactor(ctx);\n\t\t\tconst user = session.user as UserWithTwoFactor;\n\t\t\tconst twoFactor = await ctx.context.adapter.findOne<TwoFactorTable>({\n\t\t\t\tmodel: twoFactorTable,\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: user.id,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\n\t\t\tif (!twoFactor) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.TOTP_NOT_ENABLED,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst decrypted = await symmetricDecrypt({\n\t\t\t\tkey: ctx.context.secret,\n\t\t\t\tdata: twoFactor.secret,\n\t\t\t});\n\t\t\tconst status = await createOTP(decrypted, {\n\t\t\t\tperiod: opts.period,\n\t\t\t\tdigits: opts.digits,\n\t\t\t}).verify(ctx.body.code);\n\t\t\tif (!status) {\n\t\t\t\treturn invalid(\"INVALID_CODE\");\n\t\t\t}\n\n\t\t\tif (!user.twoFactorEnabled) {\n\t\t\t\tif (!session.session) {\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(\n\t\t\t\t\tuser.id,\n\t\t\t\t\t{\n\t\t\t\t\t\ttwoFactorEnabled: true,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tconst newSession = await ctx.context.internalAdapter\n\t\t\t\t\t.createSession(user.id, false, session.session)\n\t\t\t\t\t.catch((e) => {\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t});\n\n\t\t\t\tawait ctx.context.internalAdapter.deleteSession(session.session.token);\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession: newSession,\n\t\t\t\t\tuser: updatedUser,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn valid(ctx);\n\t\t},\n\t);\n\n\treturn {\n\t\tid: \"totp\",\n\t\tendpoints: {\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/totp/generate`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.generateTOTP`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/2fa#totp)\n\t\t\t */\n\t\t\tgenerateTOTP: generateTOTP,\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/two-factor/get-totp-uri`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.getTOTPURI`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.twoFactor.getTotpUri`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/2fa#getting-totp-uri)\n\t\t\t */\n\t\t\tgetTOTPURI: getTOTPURI,\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/two-factor/verify-totp`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.verifyTOTP`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.twoFactor.verifyTotp`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/2fa#verifying-totp)\n\t\t\t */\n\t\t\tverifyTOTP,\n\t\t},\n\t} satisfies TwoFactorProvider;\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1144, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/better-auth@1.4.9_drizzle-kit@0.31.8_drizzle-orm@0.45.1_@opentelemetry+api@1.9.0_@types_2c2f84378f2ef24b1a7bf909953e43a4/node_modules/better-auth/dist/plugins/two-factor/index.mjs","sources":["file:///Users/aunogarafat/Work/conversation/app/web/node_modules/.pnpm/better-auth%401.4.9_drizzle-kit%400.31.8_drizzle-orm%400.45.1_%40opentelemetry%2Bapi%401.9.0_%40types_2c2f84378f2ef24b1a7bf909953e43a4/node_modules/better-auth/src/plugins/two-factor/index.ts"],"sourcesContent":["import type { BetterAuthPlugin } from \"@better-auth/core\";\nimport {\n\tcreateAuthEndpoint,\n\tcreateAuthMiddleware,\n} from \"@better-auth/core/api\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { createHMAC } from \"@better-auth/utils/hmac\";\nimport { createOTP } from \"@better-auth/utils/otp\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { sessionMiddleware } from \"../../api\";\nimport { deleteSessionCookie, setSessionCookie } from \"../../cookies\";\nimport { symmetricEncrypt } from \"../../crypto\";\nimport { generateRandomString } from \"../../crypto/random\";\nimport { mergeSchema } from \"../../db/schema\";\nimport { validatePassword } from \"../../utils/password\";\nimport type { BackupCodeOptions } from \"./backup-codes\";\nimport { backupCode2fa, generateBackupCodes } from \"./backup-codes\";\nimport {\n\tTRUST_DEVICE_COOKIE_MAX_AGE,\n\tTRUST_DEVICE_COOKIE_NAME,\n\tTWO_FACTOR_COOKIE_NAME,\n} from \"./constant\";\nimport { TWO_FACTOR_ERROR_CODES } from \"./error-code\";\nimport { otp2fa } from \"./otp\";\nimport { schema } from \"./schema\";\nimport { totp2fa } from \"./totp\";\nimport type { TwoFactorOptions, UserWithTwoFactor } from \"./types\";\n\nexport * from \"./error-code\";\n\nconst enableTwoFactorBodySchema = z.object({\n\tpassword: z.string().meta({\n\t\tdescription: \"User password\",\n\t}),\n\tissuer: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"Custom issuer for the TOTP URI\",\n\t\t})\n\t\t.optional(),\n});\n\nconst disableTwoFactorBodySchema = z.object({\n\tpassword: z.string().meta({\n\t\tdescription: \"User password\",\n\t}),\n});\n\nexport const twoFactor = <O extends TwoFactorOptions>(options?: O) => {\n\tconst opts = {\n\t\ttwoFactorTable: \"twoFactor\",\n\t};\n\tconst backupCodeOptions = {\n\t\tstoreBackupCodes: \"encrypted\",\n\t\t...options?.backupCodeOptions,\n\t} satisfies BackupCodeOptions;\n\tconst totp = totp2fa(options?.totpOptions);\n\tconst backupCode = backupCode2fa(backupCodeOptions);\n\tconst otp = otp2fa(options?.otpOptions);\n\n\treturn {\n\t\tid: \"two-factor\",\n\t\tendpoints: {\n\t\t\t...totp.endpoints,\n\t\t\t...otp.endpoints,\n\t\t\t...backupCode.endpoints,\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/two-factor/enable`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.enableTwoFactor`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.twoFactor.enable`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/2fa#api-method-two-factor-enable)\n\t\t\t */\n\t\t\tenableTwoFactor: createAuthEndpoint(\n\t\t\t\t\"/two-factor/enable\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: enableTwoFactorBodySchema,\n\t\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tsummary: \"Enable two factor authentication\",\n\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\"Use this endpoint to enable two factor authentication. This will generate a TOTP URI and backup codes. Once the user verifies the TOTP URI, the two factor authentication will be enabled.\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttotpURI: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"TOTP URI\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tbackupCodes: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Backup codes\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst user = ctx.context.session.user as UserWithTwoFactor;\n\t\t\t\t\tconst { password, issuer } = ctx.body;\n\t\t\t\t\tconst isPasswordValid = await validatePassword(ctx, {\n\t\t\t\t\t\tpassword,\n\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t});\n\t\t\t\t\tif (!isPasswordValid) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: BASE_ERROR_CODES.INVALID_PASSWORD,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst secret = generateRandomString(32);\n\t\t\t\t\tconst encryptedSecret = await symmetricEncrypt({\n\t\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\t\tdata: secret,\n\t\t\t\t\t});\n\t\t\t\t\tconst backupCodes = await generateBackupCodes(\n\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\tbackupCodeOptions,\n\t\t\t\t\t);\n\t\t\t\t\tif (options?.skipVerificationOnEnable) {\n\t\t\t\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(\n\t\t\t\t\t\t\tuser.id,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttwoFactorEnabled: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst newSession = await ctx.context.internalAdapter.createSession(\n\t\t\t\t\t\t\tupdatedUser.id,\n\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\tctx.context.session.session,\n\t\t\t\t\t\t);\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * Update the session cookie with the new user data\n\t\t\t\t\t\t */\n\t\t\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\t\t\tsession: newSession,\n\t\t\t\t\t\t\tuser: updatedUser,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t//remove current session\n\t\t\t\t\t\tawait ctx.context.internalAdapter.deleteSession(\n\t\t\t\t\t\t\tctx.context.session.session.token,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\t//delete existing two factor\n\t\t\t\t\tawait ctx.context.adapter.deleteMany({\n\t\t\t\t\t\tmodel: opts.twoFactorTable,\n\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\t\t\tvalue: user.id,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\n\t\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\t\tmodel: opts.twoFactorTable,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tsecret: encryptedSecret,\n\t\t\t\t\t\t\tbackupCodes: backupCodes.encryptedBackupCodes,\n\t\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tconst totpURI = createOTP(secret, {\n\t\t\t\t\t\tdigits: options?.totpOptions?.digits || 6,\n\t\t\t\t\t\tperiod: options?.totpOptions?.period,\n\t\t\t\t\t}).url(issuer || options?.issuer || ctx.context.appName, user.email);\n\t\t\t\t\treturn ctx.json({ totpURI, backupCodes: backupCodes.backupCodes });\n\t\t\t\t},\n\t\t\t),\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/two-factor/disable`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.disableTwoFactor`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.twoFactor.disable`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/2fa#api-method-two-factor-disable)\n\t\t\t */\n\t\t\tdisableTwoFactor: createAuthEndpoint(\n\t\t\t\t\"/two-factor/disable\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: disableTwoFactorBodySchema,\n\t\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tsummary: \"Disable two factor authentication\",\n\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\"Use this endpoint to disable two factor authentication.\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst user = ctx.context.session.user as UserWithTwoFactor;\n\t\t\t\t\tconst { password } = ctx.body;\n\t\t\t\t\tconst isPasswordValid = await validatePassword(ctx, {\n\t\t\t\t\t\tpassword,\n\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t});\n\t\t\t\t\tif (!isPasswordValid) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: BASE_ERROR_CODES.INVALID_PASSWORD,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(\n\t\t\t\t\t\tuser.id,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttwoFactorEnabled: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t\tawait ctx.context.adapter.delete({\n\t\t\t\t\t\tmodel: opts.twoFactorTable,\n\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\t\t\tvalue: updatedUser.id,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t\tconst newSession = await ctx.context.internalAdapter.createSession(\n\t\t\t\t\t\tupdatedUser.id,\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\tctx.context.session.session,\n\t\t\t\t\t);\n\t\t\t\t\t/**\n\t\t\t\t\t * Update the session cookie with the new user data\n\t\t\t\t\t */\n\t\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\t\tsession: newSession,\n\t\t\t\t\t\tuser: updatedUser,\n\t\t\t\t\t});\n\t\t\t\t\t//remove current session\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteSession(\n\t\t\t\t\t\tctx.context.session.session.token,\n\t\t\t\t\t);\n\t\t\t\t\treturn ctx.json({ status: true });\n\t\t\t\t},\n\t\t\t),\n\t\t},\n\t\toptions: options as NoInfer<O>,\n\t\thooks: {\n\t\t\tafter: [\n\t\t\t\t{\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tcontext.path === \"/sign-in/email\" ||\n\t\t\t\t\t\t\tcontext.path === \"/sign-in/username\" ||\n\t\t\t\t\t\t\tcontext.path === \"/sign-in/phone-number\"\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst data = ctx.context.newSession;\n\t\t\t\t\t\tif (!data) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!data?.user.twoFactorEnabled) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst trustDeviceCookieAttrs = ctx.context.createAuthCookie(\n\t\t\t\t\t\t\tTRUST_DEVICE_COOKIE_NAME,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmaxAge: TRUST_DEVICE_COOKIE_MAX_AGE,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\t\t\t\t\t\t// Check for trust device cookie\n\t\t\t\t\t\tconst trustDeviceCookie = await ctx.getSignedCookie(\n\t\t\t\t\t\t\ttrustDeviceCookieAttrs.name,\n\t\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (trustDeviceCookie) {\n\t\t\t\t\t\t\tconst [token, sessionToken] = trustDeviceCookie.split(\"!\");\n\t\t\t\t\t\t\tconst expectedToken = await createHMAC(\n\t\t\t\t\t\t\t\t\"SHA-256\",\n\t\t\t\t\t\t\t\t\"base64urlnopad\",\n\t\t\t\t\t\t\t).sign(ctx.context.secret, `${data.user.id}!${sessionToken}`);\n\n\t\t\t\t\t\t\t// Checks if the token is signed correctly, not that its the current session token\n\t\t\t\t\t\t\tif (token === expectedToken) {\n\t\t\t\t\t\t\t\t// Trust device cookie is valid, refresh it and skip 2FA\n\t\t\t\t\t\t\t\tconst newTrustDeviceCookie = ctx.context.createAuthCookie(\n\t\t\t\t\t\t\t\t\tTRUST_DEVICE_COOKIE_NAME,\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tmaxAge: TRUST_DEVICE_COOKIE_MAX_AGE,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tconst newToken = await createHMAC(\n\t\t\t\t\t\t\t\t\t\"SHA-256\",\n\t\t\t\t\t\t\t\t\t\"base64urlnopad\",\n\t\t\t\t\t\t\t\t).sign(\n\t\t\t\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\t\t\t\t`${data.user.id}!${data.session.token}`,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tawait ctx.setSignedCookie(\n\t\t\t\t\t\t\t\t\tnewTrustDeviceCookie.name,\n\t\t\t\t\t\t\t\t\t`${newToken}!${data.session.token}`,\n\t\t\t\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\t\t\t\ttrustDeviceCookieAttrs.attributes,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * remove the session cookie. It's set by the sign in credential\n\t\t\t\t\t\t */\n\t\t\t\t\t\tdeleteSessionCookie(ctx, true);\n\t\t\t\t\t\tawait ctx.context.internalAdapter.deleteSession(data.session.token);\n\t\t\t\t\t\tconst maxAge = (options?.otpOptions?.period ?? 3) * 60; // 3 minutes\n\t\t\t\t\t\tconst twoFactorCookie = ctx.context.createAuthCookie(\n\t\t\t\t\t\t\tTWO_FACTOR_COOKIE_NAME,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmaxAge,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst identifier = `2fa-${generateRandomString(20)}`;\n\t\t\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\t\t\tvalue: data.user.id,\n\t\t\t\t\t\t\tidentifier,\n\t\t\t\t\t\t\texpiresAt: new Date(Date.now() + maxAge * 1000),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tawait ctx.setSignedCookie(\n\t\t\t\t\t\t\ttwoFactorCookie.name,\n\t\t\t\t\t\t\tidentifier,\n\t\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\t\ttwoFactorCookie.attributes,\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\t\ttwoFactorRedirect: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\tschema: mergeSchema(schema, options?.schema),\n\t\trateLimit: [\n\t\t\t{\n\t\t\t\tpathMatcher(path) {\n\t\t\t\t\treturn path.startsWith(\"/two-factor/\");\n\t\t\t\t},\n\t\t\t\twindow: 10,\n\t\t\t\tmax: 3,\n\t\t\t},\n\t\t],\n\t\t$ERROR_CODES: TWO_FACTOR_ERROR_CODES,\n\t} satisfies BetterAuthPlugin;\n};\n\nexport * from \"./client\";\nexport * from \"./types\";\n"],"names":[],"mappings":"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"}}]
}